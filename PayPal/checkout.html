<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PayPal JS SDK Standard Integration</title>
    <script src="https://www.paypal.com/sdk/js?client-id=AWHPrjHXfMiH7MjAzXuw4F5cihkfVhPp6DaX7Kfr4WM4jgJe4qGTy4EXO1j-tjhpNv6K7ZBlqrUvc127"></script>
  </head>
  <body>
    <div id="paypal-button-container"></div>

    <!-- Initialize the JS-SDK -->
    <script>
      paypal.Buttons({
        createOrder: function(data, actions) {
          return actions.order.create({
            purchase_units: [{
              amount: {
                value: '0.01'
              }
            }]
          });
        },
        onApprove: function(data, actions) {
          return actions.order.capture().then(function(details) {
            alert("Transaction confirmé : " + details.payer.name.given_name);

            // Envoie les détails de la transaction au serveur PHP
            fetch('process_payment.php', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                orderID: data.orderID,
                payerID: data.payerID,
                amount: details.purchase_units[0].amount.value,
                payerName: details.payer.name.given_name
              })
            }).then(function(response) {
              if (!response.ok) {
                throw new Error('Network response was not ok');
              }
              return response.json();
            }).then(function(data) {
              console.log('Success:', data);
            }).catch(function(error) {
              console.error('Error:', error);
            });
          });
        },
        onError: function(err) {
          console.error('Payment Error:', err);
          alert("Paiement échoué !");
        }
      }).render("#paypal-button-container");
    </script>
  </body>
</html>
